<!DOCTYPE html>
<style> 
.axis line, .axis path {
    shape-rendering: crispEdges;
    stroke: black;
    fill: none;
}

  #tooltip {   
    position: absolute;           
    text-align: center;
    padding: 20px;             
    margin: 10px;
    font: 12px sans-serif;        
    background: lightsteelblue;   
    border: 1px;      
    border-radius: 2px;           
    pointer-events: none;         
  }
  #tooltip h4{
    margin:0;
    font-size:14px;
  }
  #tooltip{
    background:rgba(0,0,0,0.9);
    border:1px solid grey;
    border-radius:5px;
    font-size:12px;
    width:auto;
    padding:4px;
    color:white;
    opacity:0;
  }
  #tooltip table{
    table-layout:fixed;
  }
  #tooltip tr td{
    padding:0;
    margin:0;
  }
  #tooltip tr td:nth-child(1){
    width:50px;
  }
  #tooltip tr td:nth-child(2){
    text-align:center;
  }

.circle:hover:after {
  content: attr(circletitle);
  padding: 3px 3px 3px 3px;
  margin-top: 4px;
  background: #000;
  position: absolute;
  z-index: 9999;
  color: #fff;

}

#myTitle {
  text-align: center;
  font: 40px sans-serif; 
}

.prev, .next {
  cursor: pointer;
  position: absolute;
  top: 50%;
  width: auto;
  margin-top: -22px;
  padding: 16px;
  color: white;
  font-weight: bold;
  font-size: 18px;
  transition: 0.6s ease;
  border-radius: 0 3px 3px 0;
  background-color: rgba(0,0,0,0.8);
}

.next {
  right: 0;
  border-radius: 3px 0 0 3px;
}

.circle {
    fill: steelblue;
    stroke:steelblue;
}

</style>
</style>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="libs/fullpage.js/dist/fullpage.css" />
	<!-- This following line is only necessary in the case of using the option `scrollOverflow:true` -->
	<script type="text/javascript" src="libs/fullpage.js/vendors/scrolloverflow.min.js"></script>
	<script type="text/javascript" src="libs/fullpage.js/dist/fullpage.extensions.min.js"></script>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
	<nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">CS498 Final</a>
      </div>
      <ul class="nav navbar-nav">
        <li class="active"><a href="/">Home</a></li>
        <li><a href="/index2.html">Slide 2</a></li>
        <li><a href="/index3.html">Slide 3</a></li>
      </ul>
    </div>
  </nav>


	<div class="container">
		<h3>State Economy Exploration</h3>
	<p>
		Ever wonder which states economy is currently doing the best in the United States? You may be wondering this for a variety of reasons. Maybe you want to move to a new state. Maybe you are trying to find out which state has the best opportunity to open a new business in. This interactive slide show serves to help you answer this question. Using data from the entire year of 2017, we take into account various factors to help explore which state serves your purpose the best.
	</p>
	<p>
		In the scatter plot below you can see that most states sit between 2% and 5% unemployment rate regardless of population. If you are interested in a specific region, for example the midwest, you can use the selector below to only see states from that specific region. Hover over a data point to see details. 
	</p>
	<br></br>


		<select id="mySelect" onchange="subSetStates()">
		  <option id= "AllStates" value="AllStates" onclick="subSetStates()">All States</option>
		  <option value="Midwest" onclick="subSetStates()">Midwest</option>
		  <option value="Northeast" onclick="subSetStates()">Northeast</option>
		  <option value="South" onclick="subSetStates()">South</option>
		  <option value="West" onclick="subSetStates()">West</option>
		</select>
	</div>
	<a class="prev" href="/">&#10094;</a>
	<div class="container">
	<title>Population vs Unemployment Rate</title>
	<div id="myTitle">Population vs Unemployment Rate</div>
	<div id="vis-container"> 
		<svg width="960" height="600" id="scatter1"></svg> 
	</div>
	<a class="next" href="/index3.html">&#10095;</a>
</body>

<script> 
 drawScatter = function(id, data, dataPopUnemp) {  
  	//console.log("yo");

    var margin = {top: 20, right: 15, bottom: 60, left: 60}
      , width = 960 - margin.left - margin.right
      , height = 500 - margin.top - margin.bottom;
    
    var x = d3.scale.linear()
              .domain([-1000, d3.max(data, function(d) { return d[0]; })])
              .range([ 0, width ]);
    
    var y = d3.scale.linear()
    	      .domain([0, d3.max(data, function(d) { return d[1]; })])
    	      .range([ height, 0 ]);
 
    var chart = d3.select(id)
	.attr('width', width + margin.right + margin.left)
	.attr('height', height + margin.top + margin.bottom)
	.attr('class', 'chart')

    var main = chart.append('g')
	.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
	.attr('width', width)
	.attr('height', height)
	.attr('class', 'main')   
        
    // draw the x axis
    var xAxis = d3.svg.axis()
	.scale(x)
	.orient('bottom');

    main.append('g')
	.attr("class", "x axis")
                  .attr("transform", "translate(0," + height + ")") // move axis to the bottom of the canvas
                  .call(xAxis)
                .append("text")
                  .attr("class", "label")
                  .attr("x", width) // x-offset from the xAxis, move label all the way to the right
                  .attr("y", -6)    // y-offset from the xAxis, moves text UPWARD!
                  .style("text-anchor", "end") // right-justify text
                  .text("Population Millions");

    // draw the y axis
    var yAxis = d3.svg.axis()
	.scale(y)
	.orient('left');

    main.append('g')
	.attr('transform', 'translate(0,0)')
  .attr("class", "y axis") // .orient('left') took care of axis positioning for us
                  .call(yAxis)
                .append("text")
                  .attr("class", "label")
                  .attr("transform", "rotate(-90)") // although axis is rotated, text is not
                  .attr("y", 15) // y-offset from yAxis, moves text to the RIGHT because it's rotated, and positive y is DOWN
                  .style("text-anchor", "end")
                  .text("Unemployment Rate");

    var g = main.append("svg:g"); 

    var tooltip = d3.select("#vis-container").append("div")
    			  .attr("id", "tooltip")
                  .attr("class", "tooltip")
                  .style("opacity", 0);

  // tooltip mouseover event handler
  var tipMouseover = function(d) {
      //var color = colorScale(d.manufacturer);
      //var html  = "<p>" + d[2] + "<br>Population: " + parseInt(d[0]) +  " Uneployment Rate: </br>" + d[1] +"%</p>";
      var html = "<h4>"+d[2]+"</h4><table>"+
      "<tr><td>Population:</td><td>"+(parseInt(d[0]))+" million</td></tr>"+
      "<tr><td>Unemployment Rate:</td><td>"+((d[1]))+"%</td></tr>"+
      "</table>";

      tooltip.html(html)
          .style("left", (d3.event.pageX + 15) + "px")
          .style("top", (d3.event.pageY - 28) + "px")
        .transition()
          .duration(200) // ms
          .style("opacity", .9) // started as 0!

  };
  // tooltip mouseout event handler
  var tipMouseout = function(d) {
      tooltip.transition()
          .duration(300) // ms
          .style("opacity", 0); // don't care about position!
  };


    g.selectAll("scatter-dots")
      .data(data)
      .enter().append("svg:circle")
      	  .attr("class", "circle")
          .attr("cx", function (d,i) { return x(d[0]); } )
          .attr("cy", function (d) { return y(d[1]); } )
          .attr("r", 8)
          .attr("id", function (d) { return d[2];})
          .style("fill-opacity", .4)
          .style("stroke-opacity", 1)
          .attr('visibility', 'visible')
          .on("mouseover", tipMouseover)
          .on("mouseout", tipMouseout);




  };

  d3.csv("data/GdpPopUnemp.csv", function(data) {
  	var dataPopUnemp={}; 
  	var dataTuple1 = [];  
  	var dataTuple2 = [];
  	var dataGdpUnemp={}; 
  	for (var i = 0; i < data.length; i++) {
  		var pop = parseFloat(data[i].Population);
  		var unemp = parseFloat(data[i].UnemploymentRate);
  		var gdp = parseFloat(data[i].GDPPercentChange);
  		dataPopUnemp[data[i].States] = {Population:pop, UnemploymentRate:unemp};
  		dataTuple1.push([pop, unemp, data[i].States]);
  		dataGdpUnemp[data[i].States] = {GDP:gdp, UnemploymentRate:unemp};
  		dataTuple2.push([gdp,unemp]);
  	}
  	drawScatter("#scatter1", dataTuple1, dataPopUnemp); 

  }); 


function drawSubset(region) { 
	d3.csv("data/StatesRegion.csv", function(data) { 
		statesWant = []; 
		statesToHide = []; 
		for (var i = 0; i < data.length; i++) {
			if (region == "AllStates") {
				statesWant.push(data[i].State);
			}
			else {
				if (data[i].Region == region) {
					statesWant.push(data[i].State);
				}
				else {
					statesToHide.push(data[i].State); 
				}
			}			
		}
		for (var i = 0; i < statesWant.length; i++) {
			document.getElementById(statesWant[i]).setAttribute("visibility", "visible");
		}
		for (var i = 0; i < statesToHide.length; i++) { 
			document.getElementById(statesToHide[i]).setAttribute("visibility", "hidden");
		}
	}); 
}

function subSetStates() {
    var x = document.getElementById("mySelect").value;
    if (x=="AllStates") {
    	drawSubset("AllStates");
    }
    else { 
    	drawSubset(x); 
    }
}

</script>

</html>